# üîê ASP.NET Core Web API with Two-Factor Authentication (MFA)

This project demonstrates a simple but secure implementation of **Two-Factor Authentication (2FA)** in an **ASP.NET Core Web API** using **TOTP** (Time-based One-Time Password) with **Microsoft Authenticator** or **Google Authenticator**. It uses **ASP.NET Identity**, **SQL Server**, and **QRCoder** to generate QR codes for MFA setup.

---

## ‚ú® Features

- ‚úÖ User registration with email and password
- üîê MFA using time-based one-time passwords (TOTP)
- üì± Supports Microsoft/Google Authenticator apps
- üñºÔ∏è QR code generation (Base64 PNG) for easy scanning
- üìÑ Manual entry key for Authenticator setup
- üß™ Code verification for MFA validation
- üóÑÔ∏è SQL Server for identity storage
- üí° Clean and simple API structure

---

## ‚öôÔ∏è Technology Used

- **ASP.NET Core 6+**
- **Entity Framework Core**
- **ASP.NET Core Identity**
- **SQL Server**
- **QRCoder** ‚Äì QR Code generation
- **System.Drawing.Common** ‚Äì Image processing for QR code
- **Microsoft Authenticator / Google Authenticator** ‚Äì TOTP clients

---

## üì¶ NuGet Packages

Install these packages:

```bash
dotnet add package Microsoft.AspNetCore.Identity.EntityFrameworkCore
dotnet add package QRCoder
dotnet add package System.Drawing.Common
```



> üß≠ **Note:** To use multi-factor authentication (MFA), you need to install an Authenticator app on your mobile device.
> 
> We recommend one of the following:
> - [Microsoft Authenticator (iOS/Android)](https://www.microsoft.com/en-us/security/mobile-authenticator-app)
> - [Google Authenticator (iOS/Android)](https://support.google.com/accounts/answer/1066447)

Once installed, you can scan the QR code generated by the API to link your account and receive time-based one-time passwords (TOTP).



## üõ†Ô∏è How It Works

### üîê Step 1: User Registration

Send a POST request to `/api/auth/register`:

```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "StrongPassword123!"
}
```

**Response:**
- `manualEntryKey`: Secret key for Authenticator
- `authenticatorUri`: URI that can be turned into a QR code


### üì∏ Step 2: Get QR Code (Base64 Image)

Send a GET request to `/api/auth/qr-code?email=user@example.com`:

```http
GET /api/auth/qr-code?email=user@example.com
```

**Response:**
- `manualEntryKey`: Secret key that can be entered manually in the Authenticator app
- `qrCodeImageBase64`: A Base64-encoded PNG image of the QR code


### ‚úÖ Step 3: Verify MFA Code

After scanning the QR code and setting up your account in the Authenticator app, you will receive a 6-digit time-based code.

Send a POST request to `/api/auth/verify-mfa` with the code:

```http
POST /api/auth/verify-mfa
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456"
}
```

**Response:**
- Success: `"MFA verification successful!"`
- Failure (invalid or expired code): `"Invalid or expired verification code."`
